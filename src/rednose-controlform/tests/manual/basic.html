<!DOCTYPE html>
<html>
<head>
    <title>Y.Rednose.ControlForm module test</title>
    <link href="http://netdna.bootstrapcdn.com/bootstrap/2.3.2/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.3.0/grids-min.css">

    <script src="http://yui.yahooapis.com/3.11.0/build/yui/yui.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/ckeditor/4.0.1/ckeditor.js"></script>

    <script src="../../../../../build/rednose-loader/rednose-loader.js"></script>
    <style>
        /* Left label alignment */
        .form-horizontal .control-label{
            text-align: left;
        }

        /* Append fix */
        .input-append.input-block-level > input {
            width: 375px;
        }

        /* Uploader */
        .uploader-container {
            float: right;
            margin-left: -1px;
        }

        .yui3-uploader .btn {
            -webkit-border-radius: 0 4px 4px 0;
            -moz-border-radius: 0 4px 4px 0;
            border-radius: 0 4px 4px 0;
        }

        /* Columns */
        .rednose-grid-container {
            position: absolute;
            top: 41px;
            left: 0;
            right: 0;
            bottom: 0;
        }

        .rednose-grid-left {
            background-color: purple;
        }

        .rednose-grid-center{
            background-color: yellow;
        }

        .rednose-grid-right {
            background-color: green;
        }
    </style>
</head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="brand" href="./index.html">Bootstrap</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li class="">
                        <a href="./index.html">Home</a>
                    </li>
                    <li class="">
                        <a href="./getting-started.html">Get started</a>
                    </li>
                    <li class="active">
                        <a href="./scaffolding.html">Scaffolding</a>
                    </li>
                    <li class="">
                        <a href="./base-css.html">Base CSS</a>
                    </li>
                    <li class="">
                        <a href="./components.html">Components</a>
                    </li>
                    <li class="">
                        <a href="./javascript.html">JavaScript</a>
                    </li>
                    <li class="">
                        <a href="./customize.html">Customize</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="pure-g rednose-grid-container">
    <div class="pure-u-1-5 rednose-grid-left">
        <div class="rednose-sidebar-container">
            <div>test</div>
        </div>
    </div>
    <div class="pure-u-3-5 rednose-grid-center">
        <div class="rednose-form-container">
        </div>
    </div>
    <div class="pure-u-1-5 rednose-grid-right">
        <div class="rednose-sidebar-container">
            <div>test</div>
        </div>
    </div>
</div>
<!-- <div class="row-fluid"> -->
<!-- <div class="span2">...</div> -->
<!-- <div class="span8"><div class="rednose-form-container"></div></div> -->
<!-- <div class="span2">...</div> -->
<!-- </div> -->
<script>
    YUI.Env.core.push('rednose-loader');

    YUI({
        filter: 'raw',
        "groups": {
            "rednose-ui": {
                base: "../../../../../build/"
            }
        }
    }).use('model', 'view', 'rednose-controlform', function (Y) {
        var TextControlView = Y.Base.create('textControlView', Y.View, [], {

            template:
                    '<div class="control-group">' +
                            '<label class="control-label" for="{handle}">{handle}</label>' +
                            '<div class="controls">' +
                            '<input class="input-block-level" id="{handle}" type="text"/>' +
                            '</div>' +
                            '</div>',

            render: function () {
                var container = this.get('container'),
                        model     = this.get('model'),
                        template  = this.template;

                container.setHTML(Y.Lang.sub(template, {
                    handle: model.get('handle')
                }));

                return this;
            }
        });

        function ControlViewFactory() {
            ControlViewFactory.superclass.constructor.apply(this);
        }

        ControlViewFactory.create = function (model) {
            switch (model.get('type')) {
                case 'text':
                    return new TextControlView({ model: model });
            }

            return null;
        }

        var ControlModel = Y.Base.create('controlModel', Y.Model, [], {}, {
            ATTRS: {
                handle:     { value: null },
                type:       { value: null },
                properties: { value: [] },
                required:   { value: null },
                visible:    { value: null },
                protected:  { value: null },
                readonly:   { value: null },
            }
        });

        var FormView = Y.Base.create('formView', Y.View, [], {

            template: '<form class="form-horizontal"><fieldset><legend>{caption}</legend></fieldset></form>',

            render: function () {
                var container = this.get('container'),
                        model     = this.get('model'),
                        template  = this.template;

                container.setHTML(Y.Lang.sub(template, {
                    caption: model.get('name')
                }));

                Y.Array.each(model.get('controls'), function (control) {
                    var controlModel = new ControlModel(control),
                            controlView  = ControlViewFactory.create(controlModel);

                    if (controlView) {
                        container.one('fieldset').append(controlView.render().get('container'));
                    }
                });

                return this;
            }
        });

        var skFormData = Y.JSON.parse('{"name":"SK","controls":[{"type":"text","properties":[],"weight":0,"required":false,"visible":true,"protected":false,"readonly":false,"handle":"member"},{"type":"text","properties":[],"weight":0,"required":false,"visible":true,"protected":false,"readonly":false,"handle":"fraction"},{"type":"datetime","properties":[],"weight":0,"required":false,"visible":true,"protected":false,"readonly":false,"handle":"datetime"}]}');

        var mkFormData = Y.JSON.parse('{"name":"MK","controls":[{"type":"text","properties":[],"weight":0,"required":false,"visible":true,"protected":false,"readonly":false,"handle":"director"},{"type":"checkbox","properties":[],"weight":0,"required":false,"visible":true,"protected":false,"readonly":false,"handle":"inAbsenceOf"},{"type":"text","properties":[],"weight":0,"required":false,"visible":true,"protected":false,"readonly":false,"handle":"absentdirector"},{"type":"text","properties":[],"weight":0,"required":false,"visible":true,"protected":false,"readonly":false,"handle":"member"},{"type":"text","properties":[],"weight":0,"required":false,"visible":true,"protected":false,"readonly":false,"handle":"fraction"},{"type":"datetime","properties":[],"weight":0,"required":false,"visible":true,"protected":false,"readonly":false,"handle":"datetime"},{"type":"html_folding","properties":[],"weight":0,"required":false,"visible":true,"protected":false,"readonly":false,"handle":"source"}]}');

        var container = Y.one('.rednose-form-container');

        container.append(new FormView({ model: new Y.Model(skFormData) }).render().get('container'));
        container.append(new FormView({ model: new Y.Model(mkFormData) }).render().get('container'));

        // Datepicker test.
        var dateNode = Y.Node.create(
                '<form class="form-horizontal">' +
                        '<div class="control-group">' +
                        '<label class="control-label">Date</label>' +
                        '<div class="controls">' +
                        '<div class="date"/>' +
                        '</div>' +
                        '</div>' +
                        '</form>');

        // container.append(dateNode);

        // var datePicker = new Y.Rednose.ControlFormDatepicker({
        // 	srcNode   : container.one('.date'),
        // 	properties: {
        // 		is_date: {
        // 			accepts_input: true
        // 		}
        // 	}
        // });

        // datePicker.render();

        // Rich text test.
        var htmlNode = Y.Node.create(
                '<form class="form-horizontal">' +
                        '<div class="control-group">' +
                        '<label class="control-label">Rich text</label>' +
                        '<div class="controls">' +
                        '<div class="html"/>' +
                        '</div>' +
                        '</div>' +
                        '</form>');

        container.append(htmlNode);

        var richTextEditor = new Y.Rednose.ControlFormRichTextEditor({
            srcNode   : container.one('.html'),
            properties: {
                input_properties: {
                    styles    : 'true',
                    clipboard : 'true',
                    editing   : 'true',
                    undoredo  : 'true'
                }
            }
        });

        richTextEditor.render();
    });
</script>
</body>
</html>