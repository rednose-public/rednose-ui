YUI.add("rednose-datasource-manager",function(e,t){var n=e.Base.create("choicePageView",e.View,[],{template:'<form class="form-horizontal"><fieldset><div class="control-group"><label class="control-label" for="name">Name</label><div class="controls"><input class="input-block-level" id="name" type="text"/></div></div><div class="control-group"><label class="control-label" for="identifier">Identifier</label><div class="controls"><input class="input-block-level" id="identifier" type="text"/></div></div><div class="control-group"><label class="control-label">Type</label><div class="controls"><label class="radio"><input type="radio" name="type" value="pdo" checked>Database</label><label class="radio"><input type="radio" name="type" value="dataGen">DataGen</label><label class="radio"><input type="radio" name="type" value="xml">XML Data</label></div></div></fieldset></form>',render:function(){var e=this.get("container"),t=this.template;return e.setHTML(t),this},getType:function(){var e=this.get("container");return e.one("[name=type]:checked").get("value")}}),r=e.Base.create("genericPageView",e.View,[],{template:'<form class="form-horizontal"><fieldset><div class="control-group"><label class="control-label" for="dsn">DSN</label><div class="controls"><input class="input-block-level" id="dsn" type="text"/></div></div><div class="control-group"><label class="control-label" for="username">Username</label><div class="controls"><input class="input-block-level" id="username" type="text"/></div></div><div class="control-group"><label class="control-label" for="password">Password</label><div class="controls"><input class="input-block-level" id="password" type="password"/></div></div></fieldset></form>',render:function(){var e=this.get("container"),t=this.template;return e.setHTML(t),this}}),i=e.Base.create("sourcePageView",e.View,[],{OPTION_TEMPLATE:'<option id="{id}">{value}</option>',template:'<form class="form-horizontal"><fieldset><div class="control-group"><label class="control-label radio inline"><input type="radio" name="source" value="table" data-radio-group="source" checked/> Table</label><div class="controls"><select class="input-block-level" id="table" data-radio="source"></select></div></div><div class="control-group"><label class="control-label radio inline"><input type="radio" name="source" value="query" data-radio-group="source"/> Query</label><div class="controls"><textarea rows="3" class="input-block-level" id="query" data-radio="source" disabled></textarea ></div></div></fieldset></form>',events:{"[data-radio-group]":{change:"_handleRadio"}},render:function(){var e=this.get("container"),t=this.template;return e.setHTML(t),this._refreshTables(),this},disableNode:function(e,t){if(t){e.setAttribute("disabled");return}e.hasAttribute("disabled")&&e.removeAttribute("disabled")},updateSelectNode:function(t,n){var r=this;t.empty(),e.Array.each(n,function(n){t.append(e.Lang.sub(r.OPTION_TEMPLATE,{id:n,value:n}))})},_refreshTables:function(){var t=this,n=this.get("container").one("#table");e.io(Routing.generate("rednose_dataprovider_operations_list_tables"),{method:"POST",data:"dsn=mysql:host=localhost;dbname=libbit_flowgen&username=root&password=root",on:{success:function(r,i){t.updateSelectNode(n,e.JSON.parse(i.responseText))}}})},_handleRadio:function(e){var t=this,n=e.target.get("value"),r=this.get("container");r.all("[data-radio-group]").each(function(e){var r=e.ancestor("div").one("[data-radio]"),i=r.get("id")!==n;t.disableNode(r,i),!i&&r.focus()})}}),s=e.Base.create("dataGenGenericPageView",e.View,[],{template:'<form class="form-horizontal"><fieldset><div class="control-group"><label class="control-label" for="url">URL</label><div class="controls"><input class="input-block-level" id="url" type="text"/></div></div><div class="control-group"><label class="control-label" for="username">Username</label><div class="controls"><input class="input-block-level" id="username" type="text"/></div></div><div class="control-group"><label class="control-label" for="password">Password</label><div class="controls"><input class="input-block-level" id="password" type="password"/></div></div></fieldset></form>',render:function(){var e=this.get("container"),t=this.template;return e.setHTML(t),this}}),o=e.Base.create("dataGenSourcePageView",e.View,[],{OPTION_TEMPLATE:'<option id="{id}">{value}</option>',template:'<form class="form-horizontal"><fieldset><div class="control-group"><label class="control-label" for="section">Section</label><div class="controls"><select class="input-block-level" id="section"></select></div></div></fieldset></form>',render:function(){var e=this.get("container"),t=this.template;return e.setHTML(t),this._refreshSections(),this},updateSelectNode:function(t,n){var r=this;t.empty(),e.Array.each(n,function(n){t.append(e.Lang.sub(r.OPTION_TEMPLATE,{id:n,value:n}))})},_refreshSections:function(){var t=this,n=this.get("container").one("#section");e.io(Routing.generate("rednose_dataprovider_operations_list_sections"),{method:"POST",data:"url=http://datagen-standard.dev&username=admin&password=adminpasswd",on:{success:function(r,i){t.updateSelectNode(n,e.JSON.parse(i.responseText))}}})}}),u=e.Base.create("xmlPageView",e.View,[],{UPLOADER_TEMPLATE:'<button class="btn" type="button" title="Upload"><i class="icon-upload"></i></button>',UPLOADER_CONFIG:{width:40,height:30,uploadURL:Routing.generate("rednose_framework_files_upload"),buttonClassNames:{disabled:"disabled"}},template:'<form class="form-horizontal"><fieldset><div class="control-group"><label class="control-label" for="xsd">XML Schema</label><div class="controls"><div class="input-append input-block-level"><input type="text" id="xsd" readonly><div id="xsd-uploader" class="uploader-container"></div></div></div></div><div class="control-group"><label class="control-label" for="xslt">XSLT File</label><div class="controls"><div class="input-append input-block-level"><input type="text" id="xslt" readonly><div id="xsl-uploader" class="uploader-container"></div></div></div></div><div class="control-group"><label class="control-label" for="xml">XML Data</label><div class="controls"><div class="input-append input-block-level"><input type="text" id="xml" readonly><div id="xml-uploader" class="uploader-container"></div></div></div></div><div class="control-group"><label class="control-label" for="root">Root Element</label><div class="controls"><input class="input-block-level" id="root" type="text"/></div></div></fieldset></form>'
,initializer:function(){e.Uploader.SELECT_FILES_BUTTON=this.UPLOADER_TEMPLATE},render:function(){var t=this.get("container"),n=this.template;return t.setHTML(n),this._bindUploader((new e.Uploader(this.UPLOADER_CONFIG)).render(t.one("#xsd-uploader"))),this._bindUploader((new e.Uploader(this.UPLOADER_CONFIG)).render(t.one("#xsl-uploader"))),this._bindUploader((new e.Uploader(this.UPLOADER_CONFIG)).render(t.one("#xml-uploader"))),this},_bindUploader:function(e){e.after("fileselect",this._afterFileSelect,this),e.on("uploadstart",this._onUploadStart,this),e.on("uploadcomplete",this._onUploadComplete,this),e.on("uploaderror",this._onUploadError,this),e.on("alluploadscomplete",this._onAllUploadsComplete,this)},_updateInputForUploader:function(e,t,n){var r=e.get("srcNode").ancestor(".controls").one("input");r.set("value",t),r.setAttribute("data-upload-id",n)},_afterFileSelect:function(e){var t=e.target,n=t.get("fileList");n.length>0&&t.uploadAll()},_onUploadStart:function(e){var t=e.target;t.set("enabled",!1)},_onUploadComplete:function(e){var t=e.target,n=e.file,r=e.data;t.set("enabled",!0),this._updateInputForUploader(t,n.get("name"),r)},_onUploadError:function(e){var t=e.target,n=e.statusCode;text=e.statusText,t.set("enabled",!0),console.log(n),console.log(text)},_onAllUploadsComplete:function(e){var t=e.target;t.set("enabled",!0),t.set("fileList",[])}}),a=e.Base.create("app",e.App,[],{views:{choicePage:{type:n,preserve:!0},genericPage:{type:r,parent:"choicePage",preserve:!0},sourcePage:{type:i,parent:"genericPage",preserve:!0},dataGenGenericPage:{type:s,parent:"choicePage",preserve:!0},dataGenSourcePage:{type:o,parent:"dataGenGenericPage",preserve:!0},xmlPage:{type:u,parent:"choicePage",preserve:!0}}}),f=e.Base.create("dataSourceManager",e.View,[e.Rednose.View.Nav],{_app:null,title:"New Data Source",close:!0,template:'<div><div id="app"></div></div>',initializer:function(){this.on("dataSourceManager:buttonChoice",this.showChoicePage,this),this.on("dataSourceManager:buttonChoose",this._handleButtonChoose,this),this.on("dataSourceManager:buttonGeneric",this.showGenericPage,this),this.on("dataSourceManager:buttonSource",this.showSourcePage,this),this.on("dataSourceManager:buttonDataGenGeneric",this.showDataGenGenericPage,this),this.on("dataSourceManager:buttonDataGenSource",this.showDataGenSourcePage,this),this.on("dataSourceManager:buttonClose",this._handleButtonClose,this),this.on("dataSourceManager:buttonCreate",this._handleButtonCreate,this)},render:function(){var e=this.get("container"),t=this.template;e.setHTML(t),this._app=(new a({container:e.one("#app"),transitions:!0})).render()},showChoicePage:function(){this._app.get("activeView")?this._app.showView("choicePage",{model:null}):this._app.showView("choicePage",{model:null},{transition:!1}),this._updateButtons({choose:{value:"Next",position:"right",primary:!0},close:{value:"Cancel",position:"left"}})},showGenericPage:function(){this._app.showView("genericPage",{model:null}),this._updateButtons({source:{value:"Next",position:"right",primary:!0},choice:{value:"Back",position:"right"},close:{value:"Cancel",position:"left"}})},showSourcePage:function(){this._app.showView("sourcePage",{model:null}),this._updateButtons({create:{value:"Create",position:"right",primary:!0},generic:{value:"Back",position:"right"},close:{value:"Cancel",position:"left"}})},showDataGenGenericPage:function(){this._app.showView("dataGenGenericPage",{model:null}),this._updateButtons({dataGenSource:{value:"Next",position:"right",primary:!0},choice:{value:"Back",position:"right"},close:{value:"Cancel",position:"left"}})},showDataGenSourcePage:function(){this._app.showView("dataGenSourcePage",{model:null}),this._updateButtons({create:{value:"Create",position:"right",primary:!0},dataGenGeneric:{value:"Back",position:"right"},close:{value:"Cancel",position:"left"}})},showXMLPage:function(){this._app.showView("xmlPage",{model:null}),this._updateButtons({create:{value:"Create",position:"right",primary:!0},choice:{value:"Back",position:"right"},close:{value:"Cancel",position:"left"}})},_updateButtons:function(e){this.buttons={},this.set("buttons",e)},_handleButtonChoose:function(){var e=this._app.get("activeView");switch(e.getType()){case"pdo":this.showGenericPage();break;case"dataGen":this.showDataGenGenericPage();break;case"xml":this.showXMLPage()}},_handleButtonClose:function(){console.log("close!")},_handleButtonCreate:function(){console.log("create!")}}),l=new f;l.render(),l.showChoicePage(),l.get("container").inDoc()||e.one("body").append(l.get("container")),e.namespace("Rednose.DataSourceManager").DataSourceManager=f},"1.1.0-DEV",{requires:["rednose-app","rednose-dataprovider"]});
