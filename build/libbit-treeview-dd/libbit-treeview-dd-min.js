YUI.add("libbit-treeview-dd",function(e,t){var n;n=e.Base.create("dd",e.Base,[],{initializer:function(){this.get("dragdrop")&&(e.Do.after(this._bindDD,this,"bindUI",this),this.on("drag:start",this._handleStart,this),this.on("drop:hit",this._handleDrop,this),this.on("drop:over",this._handleOver,this),this.on("drop:enter",this._handleEnter,this),this.on("drop:exit",this._handleExit,this),this.on("drag:end",this._handleEnd,this))},_bindDD:function(){var t=this,n=this.get("contentBox").get("parentNode").get("parentNode").get("parentNode"),r=this.get("tree"),i;n.addClass("libbit-content"),r.expandAll(),i=r.getNodesBy(function(){return!0}),e.each(i,function(n){var r,i;r=e.one("#"+n.labelElId).ancestor("table"),i=n.data,e.instanceOf(i,e.TB.Category)?(t._createDD(r,i),new e.DD.Drop({node:r,groups:["libbit-treeview"],bubbleTargets:t})):t._createDD(r,i)}),r.collapseAll()},_handleOver:function(t){var n=t.drop.get("node"),r=e.DD.DDM.activeDrag.get("dragNode").getY(),i=n.get("offsetTop"),s=n.get("offsetHeight"),o,u,a;n.hasClass("yui3-widget-bd")&&(n.all(".yui3-dd-drop-over").isEmpty()?n.addClass("libbit-content-drop-over"):n.hasClass("libbit-content-drop-over")&&n.removeClass("libbit-content-drop-over"),o=r-i-20,o>s?(u=e.one(".libbit-tabview .yui3-widget-bd"),a=new e.Anim({node:u,to:{scroll:function(e){return[0,e.get("scrollTop")+e.get("offsetHeight")]}},easing:e.Easing.easeOut}),a.run()):o<15&&(u=e.one(".libbit-tabview .yui3-widget-bd"),a=new e.Anim({node:u,to:{scroll:function(e){return[e.get("scrollTop")+e.get("offsetHeight"),0]}},easing:e.Easing.easeOut}),a.run()))},_createDD:function(t,n){var r=this,i;return i=(new e.DD.Drag({node:t,data:n,groups:["libbit-treeview"],bubbleTargets:r})).plug(e.Plugin.DDProxy,{moveOnEnd:!1,borderStyle:"none"}),i},_handleStart:function(t){var n=t.target,r,i,s,o;r=n.get("data"),n.get("dragNode").setContent(n.get("node").one(".ygtvlabel").get("outerHTML")),s=n.get("node"),n._prep(),n.detachAll("drag:start"),i=e.Node.create("<div></div>"),n.set("node",i),n.set("target",!0),n._prep(),o=this._createDD(s,r)},_handleDrop:function(t){var n=this.get("data"),r=t.drag.get("data").get("clientId"),i=t.drop.get("node").getAttribute("data-yui3-record"),s=n.getByClientId(r);newCat=n.getByClientId(i),s&&(e.instanceOf(s,e.TB.Category)?s.set("parent",newCat):s.set("category",newCat),s.save(function(){n.load()}))},_handleExit:function(e){var t=e.drop.get("node");t.hasClass("libbit-content-drop-over")&&t.removeClass("libbit-content-drop-over")},_handleEnd:function(e){var t=this.get("contentBox").get("parentNode").get("parentNode").get("parentNode");t.hasClass("libbit-content-drop-over")&&t.removeClass("libbit-content-drop-over")},_handleEnter:function(t){if(e.DD.DDM.activeDrag){var n=e.DD.DDM.activeDrag,r=n.get("dragNode"),i=n.get("data"),s,o,u;e.instanceOf(i,e.TB.TemplateItem)&&(o=i.get("fieldGroup"),n.set("data",o),s=r.cloneNode(!0).set("id",null).setStyle("position","absolute"),e.one("body").appendChild(s),s.setXY(r.getXY()),r.setStyle("opacity",0),r.set("innerHTML",'<div class="libbit-fieldgroup-drag"><i class="icon-align-left"></i><span> </span>'+o.get("name")+"</div>"),u=new e.Anim({node:s.one(".libbit-template-item-container"),to:{width:0,height:0},duration:".25",easing:e.Easing.easeOut}),u.on("end",function(){s.remove()}),u.run(),u=new e.Anim({node:r,to:{opacity:1},duration:".25",easing:e.Easing.easeOut}),u.run())}}},{ATTRS:{dragdrop:{value:!1}}}),e.namespace("Libbit.TreeView").DD=n},"1.0.0",{requires:["dd","event-custom"]});
