YUI.add("rednose-ruler-dd",function(e,t){function n(){}n.prototype={_size:null,initializer:function(){this._resizeMap=[],this._rulerDDEvents=[e.Do.after(this._afterRender,this,"_renderRuler",this),this.on({"resize:start":this._resizeStart,"drag:drag":this._setRulerStyles,"drag:mouseDown":this._showSizes,"drag:end":this._showSizes},this)],this._createHandles()},destructor:function(){(new e.EventHandle(this._rulerDDEvents)).detach(),e.Object.each(this._resizeMap,function(e){e.destroy({remove:!0})}),this._size=null,this._rulerDDEvents=null,this._resizeMap={}},_afterRender:function(){var e=this.get("container");e.prepend(this._marginLeft),e.append(this._marginRight),this._initializeRulerStyles()},_createHandles:function(){this._marginLeft=e.Node.create('<div class="margin-left"><span style="display: none;">10mm</span></div>'),this._marginRight=e.Node.create('<div class="margin-right"><span style="display: none;">10mm</span></div>'),this.get("vertical")?(this._createResize(this._marginLeft,"b"),this._createResize(this._marginRight,"t")):(this._createResize(this._marginLeft,"r"),this._createResize(this._marginRight,"l"))},_createResize:function(t,n){var r=new e.Resize({node:t,handles:n});r.plug(e.Plugin.ResizeConstrained),r.addTarget(this),this._resizeMap.push(r)},getSizes:function(){var e=this.sizeType,t=parseFloat(this._marginLeft.getComputedStyle(e)),n=parseFloat(this._marginRight.getComputedStyle(e));this._size===null&&this._resizeStart();var r=this._size-t-n;return{position:this._pixelMillimeter(t),size:this._pixelMillimeter(r)}},_initializeRulerStyles:function(){var e=this.get("container").one(".inner-ruler"),t=this.get("leftSize")?this.get("leftSize"):this.get("defaultOffset"),n=this.get("rightSize")?this.get("rightSize"):this.get("defaultOffset"),r=this.get("maxWidth")-t-n;this._marginLeft.setStyle(this.sizeType,t+"mm"),this._marginRight.setStyle(this.sizeType,n+"mm"),this.get("vertical")?e.setStyles({marginTop:t+"mm",height:r+"mm"}):e.setStyles({marginLeft:t+"mm",width:r+"mm"})},_resizeStart:function(e){var t=this.get("container").one(".inner-ruler"),n=this.sizeType,r=null;if(e){r=e.target.get("node");if(this.get("vertical")===!1){var i=0;if(r.hasClass("margin-left")){var s=r.get("parentNode").one(".margin-right");i=-(r.getX()-s.getX())-2}else{var o=r.get("parentNode").one(".inner-ruler");i=parseFloat(o.get("clientWidth"))+parseFloat(r.get("clientWidth"))-2}e.target.con.set("maxWidth",i)}else{var u=0;if(r.hasClass("margin-left")){var s=r.get("parentNode").one(".margin-right");u=-(r.getY()-s.getY())-2}else{var o=r.get("parentNode").one(".inner-ruler");u=parseFloat(o.get("clientHeight"))+parseFloat(r.get("clientHeight"))-2}e.target.con.set("maxHeight",u)}}this._size=parseFloat(t.getComputedStyle(n))+parseFloat(this._marginLeft.getComputedStyle(n))+parseFloat(this._marginRight.getComputedStyle(n))},_setRulerStyles:function(){var e=this.get("container"),t=this.sizeType,n=e.one(".inner-ruler"),r=parseFloat(this._marginLeft.getComputedStyle(t)),i=parseFloat(this._marginRight.getComputedStyle(t)),s=this._size-r-i;e.one(".margin-left span").setHTML(this._getMMSize(r)+"MM"),e.one(".margin-right span").setHTML(this._getMMSize(i)+"MM"),this.get("vertical")?n.setStyles({marginTop:r,height:s}):n.setStyles({marginLeft:r,width:s})},_getMMSize:function(t){var n=e.Number.format(this._pixelMillimeter(t),{thousandsSeparator:".",decimalSeparator:",",decimalPlaces:2});return n},_showSizes:function(e){var t=this.get("container").all(".margin-left span, .margin-right span");e.type==="drag:mouseDown"&&e.ev.shiftKey?t.show():t.hide()}},n.ATTRS={defaultOffset:{value:10},leftSize:{value:null},rightSize:{value:null}},e.Rednose.Ruler.DD=n,e.Base.mix(e.Rednose.Ruler,[n])},"@VERSION@",{requires:["rednose-ruler-base","resize","datatype-number"]});
