YUI.add("libbit-treeview",function(e,t){YAHOO=e.YUI2;var n;n=e.Base.create("treeView",e.Widget,[e.Libbit.TreeView.Anim,e.Libbit.TreeView.Selectable,e.Libbit.TreeView.DD],{_stateMap:[],initializer:function(){var e=this.get("contentBox"),t=this.get("width"),n=this.get("height"),r=this.get("data");e.setStyle("width",t),e.setStyle("height",n),e.setStyle("overflow","auto"),r&&r.after("load",this._refresh,this)},renderUI:function(){var t=this.get("srcNode"),n=e.Node.create('<div class="libbit-treeview-content"></div>'),r=e.stamp(n);n.set("id",r),t.append(n),this.set("treeContainer",n),this._renderTree()},_renderTree:function(){var t=this.get("data"),n=this.get("treeContainer"),r;this.get("tree")&&this.get("tree").destroy(),items=this.get("renderLeaves")?e.clone(t.get("items")):e.clone(t.getBranches()),r=new YAHOO.widget.TreeView(n.get("id"),items),r.render(),this.set("tree",r),this._attachData(),this._restoreState(),this._enhanceCells()},bindUI:function(){var t=this,n=this.get("tree"),r;n.subscribe("collapseComplete",function(e){var n=t._getTableElement(e).one(".ygtvtp, .ygtvtph, .ygtvlp, .ygtvtlh");t._setCollapsedIcon(n),t.fire("collapseComplete",{node:e})}),n.subscribe("expandComplete",function(e){var n=t._getTableElement(e).one(".ygtvtm, .ygtvtmh, .ygtvlm, .ygtvlmh");t._setExpandedIcon(n),t.fire("expandComplete",{node:e})}),n.subscribe("expand",function(){return t.get("iconClicked")}),n.subscribe("collapse",function(){return t.get("iconClicked")}),r=n.getNodesBy(function(){return!0}),e.each(r,function(e){var n=t._getTableElement(e);n.on("click",function(n){var r=n.target.get("parentNode").get("parentNode");if(r.hasClass("ygtvtp")||r.hasClass("ygtvtph")||r.hasClass("ygtvlp")||r.hasClass("ygtvlph"))t.set("iconClicked",!0),e.expand(),t.set("iconClicked",!1);else if(r.hasClass("ygtvtm")||r.hasClass("ygtvtmh")||r.hasClass("ygtvlm")||r.hasClass("ygtvlmh"))t.set("iconClicked",!0),e.collapse(),t.set("iconClicked",!1)})})},_refresh:function(){var t=this,n=this.get("tree"),r=n.getNodesBy(function(e){return e.expanded});e.Array.each(r,function(e){t._stateMap.push(e.label)}),this._renderTree(),this.bindUI(),this.fire("refresh")},_attachData:function(){var t=this,n=this.get("tree");n.expandAll(),nodes=n.getNodesBy(function(){return!0}),e.each(nodes,function(n){var r=t._getTableElement(n);model=n.data,e.instanceOf(model,e.Model)&&(r.setAttribute("data-yui3-record",model.get("clientId")),r.setData({model:model}))}),n.collapseAll()},_enhanceCells:function(){var t=this,n=this.get("boundingBox");n.all(".ygtvlabel").each(function(n){var r=t._getModelFromLabelNode(n),i=n.getContent(),s=n.ancestor("tr").one(".ygtvtp, .ygtvtph, .ygtvlp, .ygtvtlh"),o=n.ancestor("tr").one(".ygtvtm, .ygtvtmh, .ygtvlm, .ygtvlmh"),u,a;e.TB&&(e.instanceOf(r,e.TB.Category)?a="icon-folder-close":e.instanceOf(r,e.TB.FieldGroup)&&(a="icon-align-left")),a&&(u=e.Node.create('<span class="label-container"><i class="'+a+'"></i><span> '+i+"</span></div>"),n.setContent(u)),n.ancestor(".ygtvtable").set("title",i),s&&t._setCollapsedIcon(s),o&&t._setExpandedIcon(o)})},_restoreState:function(){var t=this,n=this.get("tree"),r;this._stateMap.length>0&&(r=n.getNodesBy(function(e){return t._stateMap.indexOf(e.label)>-1}),e.Array.each(r,function(e){e.expand()}),this._stateMap=[])},_getModelFromLabelNode:function(e){return e.ancestor("table").getData().model},_getTableElement:function(e){var t=this.get("boundingBox"),n=e.labelElId;return t.one("#"+n).ancestor("table")},_setCollapsedIcon:function(t){var n=t.one("a");n.one("i")?(n.one("i").removeClass("icon-chevron-down"),n.one("i").addClass("icon-chevron-right")):n.setContent(e.Node.create('<i class="icon-toggle icon-chevron-right"></i>'))},_setExpandedIcon:function(t){var n=t.one("a");n.one("i")?(n.one("i").removeClass("icon-chevron-right"),n.one("i").addClass("icon-chevron-down")):n.setContent(e.Node.create('<i class="icon-toggle icon-chevron-down"></i>'))}},{ATTRS:{data:{value:null},tree:{value:null},width:{value:null},height:{value:null},renderLeaves:{value:!0},iconClicked:{value:!1}}}),e.namespace("Libbit").TreeView=n},"1.0.0",{requires:["anim","libbit-model-tree","libbit-treeview-anim","libbit-treeview-select","libbit-treeview-dd","widget","yui2-treeview"],skinnable:!0});
