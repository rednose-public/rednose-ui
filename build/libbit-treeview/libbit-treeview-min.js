YUI.add("libbit-treeview",function(e,t){var n;n=e.Base.create("treeView",e.Widget,[e.Libbit.TreeView.Anim,e.Libbit.TreeView.Filter],{_stateMap:[],afterEvent:null,openEvent:null,closeEvent:null,initializer:function(){var e=this.get("contentBox"),t=this.get("width"),n=this.get("height"),r=this.get("data");e.setStyle("width",t),e.setStyle("height",n),e.setStyle("overflow","auto"),r&&(this.afterEvent=r.after("load",this._refresh,this))},renderUI:function(){var t=this.get("srcNode"),n=e.Node.create('<div class="libbit-treeview-content"></div>'),r=e.stamp(n);n.set("id",r),t.append(n),this.set("treeContainer",n),this._renderTree()},_renderTree:function(){var t=this.get("data"),n=this,r;items=t.get("items");if(this.get("tree")){r=this.get("tree");while(r.rootNode.children.length>0)r.removeNode(r.rootNode.children[0]);for(var i in items)r.insertNode(r.rootNode,items[i])}else r=new e.TreeView({container:this.get("srcNode"),nodes:items}),this.set("tree",r);r.render(),this.openEvent&&(this.openEvent.detach(),this.closeEvent.detach()),this._processTree(r.rootNode),this.openEvent=r.on("open",function(e){var t=r.getHTMLNode(e.node);n._stateMap.push(parseInt(t.getAttribute("data-yui3-modelId")))}),this.closeEvent=r.on("close",function(t){var i=r.getHTMLNode(t.node),s=e.Array.indexOf(n._stateMap,parseInt(i.getAttribute("data-yui3-modelId")));delete n._stateMap[s]})},_refresh:function(){this._renderTree(),this.fire("refresh")},_processTree:function(t){var n=this,r=this.get("tree");t.open();for(var i in t.children){var s=t.children[i],o=r.getHTMLNode(s);model=s.data,e.instanceOf(model,e.Model)&&(o.setAttribute("data-yui3-modelId",model.get("id")),o.setAttribute("data-yui3-record",model.get("clientId")),o.setData({model:model})),s.children&&n._processTree(s)}t!==r.rootNode&&(console.log(n._stateMap),e.Array.indexOf(n._stateMap,t.data.get("id"))===-1&&t.close())},_enhanceCells:function(){var t=this,n=this.get("boundingBox");n.all(".ygtvlabel").each(function(n){var r=t._getModelFromLabelNode(n),i=n.getContent(),s=n.ancestor("tr").one(".ygtvtp, .ygtvtph, .ygtvlp, .ygtvtlh"),o=n.ancestor("tr").one(".ygtvtm, .ygtvtmh, .ygtvlm, .ygtvlmh"),u,a;e.TB&&(e.instanceOf(r,e.TB.Category)?a="icon-folder-close":e.instanceOf(r,e.TB.FieldGroup)?a="icon-align-left":e.instanceOf(r,e.TB.Image)?a="icon-picture":e.instanceOf(r,e.DocGen.Table)&&(a="icon-th")),a&&(u=e.Node.create('<span class="label-container"><i class="'+a+'"></i><span> '+i+"</span></div>"),n.setContent(u)),n.ancestor(".ygtvtable").set("title",i),s&&t._setCollapsedIcon(s),o&&t._setExpandedIcon(o)})},_setCollapsedIcon:function(t){var n=t.one("a");n.one("i")?(n.one("i").removeClass("icon-chevron-down"),n.one("i").addClass("icon-chevron-right")):n.setContent(e.Node.create('<i class="icon-toggle icon-chevron-right"></i>'))},_setExpandedIcon:function(t){var n=t.one("a");n.one("i")?(n.one("i").removeClass("icon-chevron-right"),n.one("i").addClass("icon-chevron-down")):n.setContent(e.Node.create('<i class="icon-toggle icon-chevron-down"></i>'))}},{ATTRS:{data:{value:null},tree:{value:null},width:{value:null},height:{value:null},renderLeaves:{value:!0},iconClicked:{value:!1}}}),e.namespace("Libbit").TreeView=n},"1.0.0",{requires:["anim","libbit-model-tree","libbit-treeview-filter","libbit-treeview-anim","libbit-treeview-select","libbit-treeview-dd","widget","gallery-sm-treeview"],skinnable:!0});
