YUI.add("libbit-treeview",function(e,t){var n,r=e.Template.Micro;e.namespace("TreeView").Templates={children:r.compile('<ul class="<%= data.classNames.children %>" <% if (data.node.isRoot()) { %>role="tree" tabindex="0"<% } else { %>role="group"<% } %>></ul>'),node:r.compile('<li id="<%= data.node.id %>" class="<%= data.nodeClassNames.join(" ") %>" role="treeitem" aria-labelled-by="<%= data.node.id %>-label"><div class="<%= data.classNames.row %>" data-node-id="<%= data.node.id %>" data-libbit-type="<%= data.node.data.name %>" data-libbit-id="<%= data.node.data.get(\'id\')%>"><span class="<%= data.classNames.indicator %>"><s></s></span><span class="<%= data.classNames.icon %>"></span><span id="<%= data.node.id %>-label" class="<%= data.classNames.label %>"><%== data.node.label %></span></div></li>')},n=e.Base.create("treeView",e.TreeView,[e.Libbit.TreeView.Anim,e.Libbit.TreeView.DD,e.Libbit.TreeView.Selectable],{_stateMap:[],_iconMap:[],initializer:function(e){e.nodes=e.model.get("items"),this.set("model",e.model),e.header&&(this.header=e.header);var t=this.classNames,n=this.get("container"),r=this.get("model");this.on("open",this._handleExpand,this),this.on("close",this._handleCollapse,this),r.get("icons")&&(this._iconMap=r.get("icons")),this._eventHandles||(this._eventHandles=[]),this._eventHandles.push(r.after("change",this._handleModelChange,this))},destructor:function(){(new e.EventHandle(this._eventHandles)).detach()},render:function(){var t=this.get("container"),n="ontouchstart"in e.config.win;return t.addClass(this.classNames.treeview),t.addClass(this.classNames[n?"touch":"noTouch"]),this._childrenNode=this.renderChildren(this.rootNode,{container:t}),this.rendered=!0,console.log("renderTree"),this},_handleModelChange:function(){this.fire("mc");var e=this.get("model").get("items");this.clear({silent:!0});if(e){var t=this.insertNode(this.rootNode,e,{silent:!0});this._restoreTreeOpenState(t)}this.render()},_generateLibbitRecordId:function(t){return t instanceof e.Model?t.name+"_"+t.get("id"):null},_parseLibbitRecordId:function(e){return e.split("_")},_restoreTreeOpenState:function(){var t=this,n=this.rootNode;n.hasChildren()&&this._stateMap&&this._stateMap.length>0&&e.Array.each(n.children,function(e){t._restoreNodeOpenState(e)})},_restoreNodeOpenState:function(t){var n=this._generateLibbitRecordId(t.data),r=e.Array.indexOf(this._stateMap,n);r!==-1&&t.open({silent:!0}),t.hasChildren()&&e.Array.each(t.children,function(e){this._restoreNodeOpenState(e)},this)},_processTree:function(e){e.children.length;for(var t in e.children){var n=e.children[t];n.children&&this._processTree(n)}},_fixWidth:function(e){var t=this.getHTMLNode(e),n=0,r=t.ancestor("."+this.classNames.children);while(r.ancestor("."+this.classNames.children))n++,r=r.ancestor("."+this.classNames.children);if(n>0){var i=n*20;i&&(t.setStyle("marginLeft",-i),t.one("div").setStyle("paddingLeft",i+20),t.ancestor("."+this.classNames.children).setStyle("marginLeft",i),t.one("."+this.classNames.indicator).setStyle("marginLeft",i))}},_bindModel:function(e){var t=this.getHTMLNode(e),n=e.data;console.log(t)},_setIcon:function(e,t){if(e){var n=e.one("."+this.classNames.icon);n&&(n.removeClass(this.classNames.icon),n.addClass(t),n.addClass("libbit-treeview-icon"))}},_attachEvents:function(){this.on("open",this._handleExpand,this),this.on("close",this._handleCollapse,this)},_detachEvents:function(){this.detach("open",this._handleExpand),this.detach("close",this._handleCollapse),this.detach("select",this._handleSelectState)},_handleIcon:function(e){var t=e.node,n=e.type,r=this.getHTMLNode(t).one(".icon-folder-close");n==="treeView:close"&&(r=this.getHTMLNode(t).one(".icon-folder-open")),r&&(n==="treeView:close"?(r.removeClass("icon-folder-open"),r.addClass("icon-folder-close")):(r.removeClass("icon-folder-close"),r.addClass("icon-folder-open")))},_handleExpand:function(t){var n=this._generateLibbitRecordId(t.node.data),r=e.Array.indexOf(this._stateMap,n);r===-1&&this._stateMap.push(n)},_handleCollapse:function(t){var n=this._generateLibbitRecordId(t.node.data),r=e.Array.indexOf(this._stateMap,n);r!==-1&&this._stateMap.splice(r,1)},_disableEvent:function(e){e.stopImmediatePropagation()}},{ATTRS:{header:{value:null},filter:{value:{type:null,attr:null,value:[]}}}}),e.namespace("Libbit").TreeView=n},"1.0.0",{requires:["gallery-sm-treeview","libbit-model-tree","libbit-treeview-anim","libbit-treeview-dd","libbit-treeview-filter","libbit-treeview-select"],supersedes:["gallery-sm-treeview-templates"],skinnable:!0});
