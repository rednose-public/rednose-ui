YUI.add("libbit-treeview",function(e,t){var n,r=e.Template.Micro;e.namespace("TreeView").Templates={children:r.compile('<ul class="<%= data.classNames.children %>" <% if (data.node.isRoot()) { %>role="tree" tabindex="0"<% } else { %>role="group"<% } %>></ul>'),node:r.compile('<li id="<%= data.node.id %>" class="<%= data.nodeClassNames.join(" ") %>" role="treeitem" aria-labelled-by="<%= data.node.id %>-label"><div class="<%= data.classNames.row %>" data-node-id="<%= data.node.id %>" data-libbit-type="<%= data.node.data.name %>" data-libbit-id="<%= data.node.data.get(\'id\')%>"><span class="<%= data.classNames.indicator %>"><s></s></span><span class="<%= data.classNames.icon %>"></span><span id="<%= data.node.id %>-label" class="<%= data.classNames.label %>"><%== data.node.label %></span></div></li>')},n=e.Base.create("treeView",e.TreeView,[e.Libbit.TreeView.Anim,e.Libbit.TreeView.DD],{_stateMap:[],_selectMap:[],_iconMap:[],initializer:function(e){e.nodes=e.data.get("items"),this.set("data",e.data),e.header&&(this.header=e.header);var t=this.classNames,n=this.get("container"),r=this.get("data");this.on("open",this._handleExpand,this),this.on("close",this._handleCollapse,this),this.on("select",this._handleSelectState,this),this.on("unselect",this._handleUnSelectState,this),r.get("icons")&&(this._iconMap=r.get("icons"))},render:function(){var t=this.get("container"),n=this.get("header");this.constructor.superclass.render.apply(this);var r=this;e.Array.each(this._selectMap,function(e){var n=r._parseLibbitRecordId(e);t.all("[data-libbit-type="+n[0]+"]").each(function(e){e.getData("libbit-id")===n[1]&&r.getNodeById(e.getData("node-id")).select()})})},refresh:function(){if(!this.rendered)return;var t=this.get("data").get("items");this.clear({silent:!0});if(t){var n=this.insertNode(this.rootNode,t,{silent:!0});e.Array.each(n,function(e){this.test(e)},this)}this.render()},_generateLibbitRecordId:function(t){return t instanceof e.Model?t.name+"_"+t.get("id"):null},_parseLibbitRecordId:function(e){return e.split("_")},test:function(t){var n=this._generateLibbitRecordId(t.data),r=e.Array.indexOf(this._stateMap,n);r!==-1&&t.open({silent:!0}),t.hasChildren()&&e.Array.each(t.children,function(e){this.test(e)},this)},_buildTree:function(){var e=this.get("data").get("items");if(this.rendered)while(this.rootNode.children.length>0)this.removeNode(this.rootNode.children[0]);for(var t in e){var n=this.insertNode(this.rootNode,e[t],{silent:!0});console.log(n)}},_processTree:function(e){e.children.length;for(var t in e.children){var n=e.children[t];n.children&&this._processTree(n)}},_fixWidth:function(e){var t=this.getHTMLNode(e),n=0,r=t.ancestor("."+this.classNames.children);while(r.ancestor("."+this.classNames.children))n++,r=r.ancestor("."+this.classNames.children);if(n>0){var i=n*20;i&&(t.setStyle("marginLeft",-i),t.one("div").setStyle("paddingLeft",i+20),t.ancestor("."+this.classNames.children).setStyle("marginLeft",i),t.one("."+this.classNames.indicator).setStyle("marginLeft",i))}},_bindModel:function(e){var t=this.getHTMLNode(e),n=e.data;console.log(t)},_setIcon:function(e,t){if(e){var n=e.one("."+this.classNames.icon);n&&(n.removeClass(this.classNames.icon),n.addClass(t),n.addClass("libbit-treeview-icon"))}},_attachEvents:function(){this.on("open",this._handleExpand,this),this.on("close",this._handleCollapse,this)},_detachEvents:function(){this.detach("open",this._handleExpand),this.detach("close",this._handleCollapse),this.detach("select",this._handleSelectState)},_handleSelectState:function(t){var n=this._generateLibbitRecordId(t.node.data),r=e.Array.indexOf(this._selectMap,n);r===-1&&this._selectMap.push(n)},_handleUnSelectState:function(t){var n=this._generateLibbitRecordId(t.node.data),r=e.Array.indexOf(this._selectMap,n);r!==-1&&this._selectMap.splice(r,1)},_handleIcon:function(e){var t=e.node,n=e.type,r=this.getHTMLNode(t).one(".icon-folder-close");n==="treeView:close"&&(r=this.getHTMLNode(t).one(".icon-folder-open")),r&&(n==="treeView:close"?(r.removeClass("icon-folder-open"),r.addClass("icon-folder-close")):(r.removeClass("icon-folder-close"),r.addClass("icon-folder-open")))},_handleExpand:function(t){var n=this._generateLibbitRecordId(t.node.data),r=e.Array.indexOf(this._stateMap,n);r===-1&&this._stateMap.push(n)},_handleCollapse:function(t){var n=this._generateLibbitRecordId(t.node.data),r=e.Array.indexOf(this._stateMap,n);r!==-1&&this._stateMap.splice(r,1)},_disableEvent:function(e){e.stopImmediatePropagation()}},{ATTRS:{header:{value:null},filter:{value:{type:null,attr:null,value:[]}}}}),e.namespace("Libbit").TreeView=n},"1.0.0",{requires:["gallery-sm-treeview","libbit-model-tree","libbit-treeview-anim","libbit-treeview-dd","libbit-treeview-filter","libbit-treeview-select"],supersedes:["gallery-sm-treeview-templates"],skinnable:!0});
