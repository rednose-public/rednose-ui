YUI.add("libbit-treeview",function(e,t){var n;n=e.Base.create("treeView",e.TreeView,[e.Libbit.TreeView.Anim,e.Libbit.TreeView.DD,e.Libbit.TreeView.Selectable],{header:{value:null},_stateMap:[],initializer:function(e){e.nodes=e.model.get("items"),e.header&&(this.header=e.header);var t=e.model;this.set("model",t),this._attachEventHandles()},destructor:function(){this._detachEventHandles()},render:function(){var t=this.get("container"),n="ontouchstart"in e.config.win,r=this.header;return this.rendered||(t.addClass(this.classNames.treeview),t.addClass(this.classNames[n?"touch":"noTouch"]),r&&t.append('<div class="nav-header">'+r+"</div>")),this._childrenNode=this.renderChildren(this.rootNode,{container:t}),this.rendered=!0,this},_attachEventHandles:function(){this._eventHandles||(this._eventHandles=[]);var e=this.get("model");this._eventHandles.push(this.on("open",this._handleExpand,this),this.on("close",this._handleCollapse,this),e.after("change",this._handleModelChange,this))},_detachEventHandles:function(){(new e.EventHandle(this._eventHandles)).detach()},_generateLibbitRecordId:function(t){return t instanceof e.Model?t.name+"_"+t.get("id"):null},_parseLibbitRecordId:function(e){return e.split("_")},_restoreTreeOpenState:function(){var t=this,n=this.rootNode;n.hasChildren()&&this._stateMap&&this._stateMap.length>0&&e.Array.each(n.children,function(e){t._restoreNodeOpenState(e)})},_restoreNodeOpenState:function(t){var n=this._generateLibbitRecordId(t.data),r=e.Array.indexOf(this._stateMap,n);r!==-1&&t.open({silent:!0}),t.hasChildren()&&e.Array.each(t.children,function(e){this._restoreNodeOpenState(e)},this)},_handleExpand:function(t){var n=this._generateLibbitRecordId(t.node.data),r=e.Array.indexOf(this._stateMap,n);r===-1&&this._stateMap.push(n)},_handleCollapse:function(t){var n=this._generateLibbitRecordId(t.node.data),r=e.Array.indexOf(this._stateMap,n);r!==-1&&this._stateMap.splice(r,1)},_handleModelChange:function(){var e=this.get("model").get("items");this.clear({silent:!0});if(e){var t=this.insertNode(this.rootNode,e,{silent:!0});this._restoreTreeOpenState(t)}this.render()}}),e.namespace("Libbit").TreeView=n},"1.0.0",{requires:["gallery-sm-treeview","libbit-model-tree","libbit-treeview-anim","libbit-treeview-dd","libbit-treeview-filter","libbit-treeview-templates","libbit-treeview-select"],supersedes:["gallery-sm-treeview-templates"],skinnable:!0});
