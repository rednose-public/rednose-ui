YUI.add("rednose-colorpicker",function(e,t){var n=e.Base.create("colorpicker",e.Widget,[],{template:'<div class="input-append"><input type="text" id="color" value="#FFFFFF" readonly="true" /><button title="Configure table" type="button" class="btn"><i class="icon-adjust"></i></button></div>',_canvas:null,_imageObj:null,_imageData:null,_mouseActive:!1,initializer:function(){var t=this;this._canvas=e.Node.create("<canvas></canvas>").getDOMNode(),this._canvas.addEventListener("mousemove",function(e){t._mouseOver(e)}),this._canvas.addEventListener("mousedown",function(){t._mouseActive=!0}),this._canvas.addEventListener("mouseup",function(){t._mouseActive=!1}),this.after("colorChange",this._handleColorChange,this)},destructor:function(){this._canvas.removeEventListener("mousemove")},renderUI:function(){var e=this,t=this.get("contentBox"),n=new Image;t.addClass("rednose-colorpicker"),t.append(this.template),t.one("button").on("click",this._handleColorClicked,this)},_handleColorChange:function(){var e=this.get("color"),t=this.get("hex").toUpperCase(),n=this.get("contentBox").one("#color");n.set("value",t),n.setStyle("backgroundColor",t),contrast=1-(.299*e.red+.587*e.green+.114*e.blue)/255,console.log(contrast),contrast<.5?n.setStyle("color","black"):n.setStyle("color","white")},_handleColorClicked:function(t){var n=this.get("contentBox"),r=t.currentTarget,i=new e.Node.create('<div class="dropdown-menu"></div>');this._renderCanvas(),i.append(this._canvas),i.setStyle("display","block"),i.setStyle("left",n.getX()),i.setStyle("top",r.getY()+parseInt(r.getComputedStyle("height"))),i.on("clickoutside",function(e){e.target!==r&&i.remove()}),n.append(i)},_mouseOver:function(e){if(this._mouseActive===!0){var t=this._canvas.getBoundingClientRect(),n=e.clientX-t.left,r=e.clientY-t.top;this.set("color",this._getColor(n,r))}},_getColor:function(e,t){var n=this._canvas.getContext("2d");imgObj=this._imageObj,this._imageData===null&&(this._imageData=n.getImageData(0,0,imgObj.height,imgObj.width));var r=this._imageData.data,i=r[(imgObj.width*t+e)*4],s=r[(imgObj.width*t+e)*4+1],o=r[(imgObj.width*t+e)*4+2];return{red:i,green:s,blue:o}},_renderCanvas:function(){var t=this.get("contentBox"),n=e.Node.create('<canvas class="buffer" />'),r=this._canvas.getContext("2d"),i=new Image;t.append(n),t.append(this._canvas);var s=n.getStyle("backgroundImage").replace("url(","").replace(/'/,"").replace(/"/g,"").replace(/[)]/g,"");i.onload=function(){r.drawImage(i,0,0)},i.src=s,this._imageObj=i},_getHex:function(){var e=this.get("color");rgb=[e.red.toString(),e.green.toString(),e.blue.toString()];var t="#"+("0"+parseInt(rgb[0],10).toString(16)).slice(-2)+("0"+parseInt(rgb[1],10).toString(16)).slice(-2)+("0"+parseInt(rgb[2],10).toString(16)).slice(-2);return t}},{ATTRS:{color:{value:{green:0,red:0,blue:0}},hex:{value:null,getter:"_getHex"}}});e.namespace("Rednose").Colorpicker=n},"1.5.0-DEV",{requires:["base","event","node","widget"]});
