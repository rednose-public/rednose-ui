YUI.add("libbit-dd",function(e,t){var n,r;r=e.Base.create("bubbleTarget",e.Base,[],{}),n=e.Base.create("dd",e.View,[],{dropHighlight:!1,events:{".libbit-dd-drag":{mouseenter:"_handleMouseEnter",mouseleave:"_handleMouseLeave"}},initializer:function(){e.DD.DDM.set("dragCursor","default"),this.bubbleTarget=new r,this.bubbleTarget.addTarget(this),this.bubbleTarget.on("drop:hit",this._libbitDropHit,this)},_libbitDropHit:function(e){e.drag.get("node").get("parentNode")===null&&e.stopImmediatePropagation()},createDrag:function(t,n){t.addClass("libbit-dd-drag");var r=new e.DD.Drag({node:t,groups:n,bubbleTargets:this,target:!0});return r.plug(e.Plugin.DDProxy,{moveOnEnd:!1,borderStyle:"none"}),r},createDrop:function(t,n){t.addClass("libbit-dd-drop");var r=new e.DD.Drop({node:t,groups:n,bubbleTargets:this});return r},bindGlobalDrop:function(t,n){var r;n=n||this.get("container"),n.addClass("libbit-global-drop"),r=new e.DD.Drop({node:n,groups:t,bubbleTargets:this.bubbleTarget}),r.on("drop:enter",this._dropEnterGlobal,this)},_handleStart:function(e){var t=e.target,n=t.get("node").cloneNode(!0).addClass("libbit-dd-drag-proxy");t.get("dragNode").set("innerHTML",n.get("outerHTML")),t.get("node").addClass("libbit-dd-drag-placeholder"),t.get("node").setStyle("visibility","hidden")},_handleEnd:function(t){var n=t.target;e.Array.each(n.getTargets(),function(e){n.removeTarget(e)}),n.addTarget(this),n.detach("drag:end",this._handleEnd),n._unprep(),n._prep(),n.get("node").addClass("libbit-dd-drag"),n.get("node").removeClass("libbit-dd-drag-placeholder"),n.get("dragNode").set("innerHTML",""),n.get("node").setStyle("visibility","")},_dropOver:function(t){var n=t.drop.get("node"),r=t.drag.get("node");if(n.hasClass("libbit-global-drop"))return;n.get("tagName").toLowerCase()!=="li"&&(n.contains(r)||(n.appendChild(r),e.DD.DDM.syncActiveShims(!0)))},_dropEnter:function(e){if(!e.drag||!e.drop||e.drop!==e.target)return!1;e.drop.get("node").get("tagName").toLowerCase()==="li"&&this._moveItem(e.drag,e.drop)},_moveItem:function(t,n){var r=t.get("node"),i=n.get("node"),s=!1,o=10,u=t.mouseXY,a=n.region,f=a.top+(a.bottom-a.top)/2,l=a.left+(a.right-a.left)/2,c=!1,h=!1,p=!1,d,v;if(i.hasClass("libbit-global-drop"))return;i.get("tagName").toLowerCase()!=="ul"?v=i.ancestor("ul"):v=i;if(v){var m=e.DD.DDM.activeDrag.get("dragNode"),g=v.get("offsetWidth");e.Libbit.Anim.width(m,g)}u[1]<a.top+o&&(h="top"),a.bottom-o<u[1]&&(h="bottom"),a.right-o<u[0]&&(p="right"),u[0]<a.left+o&&(p="left"),c=p,p===!1&&(c=h);switch(c){case"top":break;case"bottom":break;case"right":case"left":}if(i!==null&&c&&i&&i.get("parentNode")){if(!s){var y=e.Node.create(r.get("innerHTML"));c==="top"?(i.get("parentNode").insertBefore(y,r),i.get("previousSibling")&&i.get("nextSibling")&&(i=i.get("nextSibling")),i.get("nextSibling")?i.get("parentNode").insertBefore(r,i):i.get("parentNode").appendChild(r)):(i.get("parentNode").insertBefore(y,r),i.get("parentNode").insertBefore(r,i));var b=r.get("scrollHeight");r.setStyle("height",0),y.setStyle("overflow","hidden"),y.setStyle("visibility","hidden");var w=new e.Anim({node:r,to:{height:b},duration:".25",easing:e.Easing.easeOut});w.run();var E=new e.Anim({node:y,to:{height:0},duration:".25",easing:e.Easing.easeOut});E.on("end",function(){y.remove()}),E.run()}else i.get("parentNode").appendChild(r);e.DD.DDM.syncActiveShims(!0)}},_dropEnterGlobal:function(t){if(e.DD.DDM.activeDrag){var n=e.DD.DDM.activeDrag,r=n.get("dragNode"),i=n.get("data"),s,o;if(i.name==="fieldGroup"||i.name==="image"||i.name==="table"){n.on("drag:end",this._handleEnd,this);var o=new e.TB.TemplateItem({asset:i}),u=new e.TB.TemplateItemView({model:o});u.templateModel=this.get("model"),s=u.render().get("container"),s.plug(e.Libbit.ContextMenu,{content:[{title:"Remove from template",id:"removeTemplateItem"},{title:"-"},{title:"Properties",id:"templateItemProperties",disabled:!0}],bubbleTarget:u});var a=s.cloneNode(!0).addClass("libbit-dd-drag-proxy");s.addClass("libbit-dd-drag-placeholder"),s.setData({model:o}),n.get("node").remove(),n.set("node",s),e.Libbit.Anim.morph(r,a,e.Libbit.Anim.fadeOut,e.Libbit.Anim.slideIn)}}},_handleMouseEnter:function(e){var t=e.currentTarget;t.ancestor(".libbit-dd-drag-hover")&&t.ancestor(".libbit-dd-drag-hover").replaceClass("libbit-dd-drag-hover","libbit-dd-drag-hover-disabled"),t.one(".libbit-dd-drag-hover")?t.addClass("libbit-dd-drag-hover-disabled"):t.addClass("libbit-dd-drag-hover")},_handleMouseLeave:function(e){var t=e.currentTarget;t.hasClass("libbit-dd-drag-hover")&&t.removeClass("libbit-dd-drag-hover"),t.ancestor(".libbit-dd-drag-hover-disabled")&&t.ancestor(".libbit-dd-drag-hover-disabled").replaceClass("libbit-dd-drag-hover-disabled","libbit-dd-drag-hover")}}),e.namespace("Libbit").DD=n},"1.0.0",{requires:["libbit-anim","libbit-dd-css","view"]});
