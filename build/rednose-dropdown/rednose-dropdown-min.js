YUI.add("rednose-dropdown",function(e,t){var n=e.Template.Micro,r="click",i=e.Base.create("dropdown",e.Rednose.Dropdown.Base,[e.View],{rendered:!1,initializer:function(){var t=e.Rednose.Dropdown.ClassNames;this.onceAfter("initializedChange",function(){this.get("container").addClass(t.dropdown),this._attachDropdownEvents()})},destructor:function(){this._detachDropdownEvents()},getHTMLNode:function(e){var t=this.get("container");return t.one('[data-id="'+e.id+'"]')},render:function(){var t=this.get("container");return this._rootItems&&t.append(this._renderMenu(this._rootItems)),t.inDoc()||e.one("body").append(t),this.rendered=!0,this},_attachDropdownEvents:function(){this._events||(this._events=[]);var t=this.get("container"),n=e.Rednose.Dropdown.ClassNames;this._events.push(this.after({open:this._afterOpen,close:this._afterClose,enable:this._afterEnable,disable:this._afterDisable,activate:this._afterActivate,deactivate:this._afterDeactivate,rename:this._afterRename,reset:this._afterReset,resetChildren:this._afterReset}),t.delegate("click",this._afterItemClick,"."+n.menu+" a",this),t.on("clickoutside",this._onClickOutside,this),t.on("mouseupoutside",this._onMouseUpOutside,this),e.one("body").on("contextmenu",this._onBodyContextMenu,this))},_detachDropdownEvents:function(){(new e.EventHandle(this._events)).detach()},_renderMenu:function(t){var n=e.Node.create(e.Rednose.Dropdown.Templates.menu({classNames:e.Rednose.Dropdown.ClassNames}));for(var r=0,i=t.length;r<i;r++)n.append(this._renderItem(t[r]));return n},_renderItem:function(t){var n=e.Node.create(e.Rednose.Dropdown.Templates.item({classNames:e.Rednose.Dropdown.ClassNames,item:t,dropdown:this}));return t.html?(n.one("a")&&n.one("a").setAttribute("data-id",t.id),n):(t.type==="item"&&n.append(this._renderContent(t)),t.children&&n.append(this._renderMenu(t.children)),n)},_renderContent:function(t){var n=e.Rednose.Dropdown.Templates,r=e.Rednose.Dropdown.ClassNames;return e.Node.create(n.content({classNames:r,item:t}))},_onClickOutside:function(e){e.button!==3&&this.close()},_onBodyContextMenu:function(e){var t=this._host||this.get("container");t.contains(e.target)||this.close()},_afterItemClick:function(e){var t=e.currentTarget,n=this.getItemById(t.getAttribute("data-id")),i=r+"#"+n.id;(n.isDisabled()||n.url==="#")&&e.preventDefault();if(n.isDisabled()||n.hasChildren())return;n.toggle&&n.toggleActive(),this._published[i]||(this._published[i]=this.publish(i,{defaultFn:this._defItemClickFn})),this._published[r]||(this._published[r]=this.publish(r,{defaultFn:this._defClickFn})),this.fire(i,{originEvent:e,dropdown:this,item:n,node:this.get("host")})},_afterOpen:function(){this.rendered||this.render();var t=this.get("container"),n=e.Rednose.Dropdown.ClassNames;t.addClass(n.open)},_afterClose:function(){var t=this.get("container"),n=e.Rednose.Dropdown.ClassNames;t.removeClass(n.open)},_afterEnable:function(t){var n=this.getHTMLNode(t.item),r=e.Rednose.Dropdown.ClassNames;n&&n.get("parentNode").removeClass(r.disabled)},_afterDisable:function(t){var n=this.getHTMLNode(t.item),r=e.Rednose.Dropdown.ClassNames;n&&n.get("parentNode").addClass(r.disabled)},_afterActivate:function(e){var t=this.getHTMLNode(e.item);t&&t.replace(this._renderContent(e.item))},_afterDeactivate:function(e){var t=this.getHTMLNode(e.item);t&&t.replace(this._renderContent(e.item))},_afterRename:function(e){var t=this.getHTMLNode(e.item);t&&t.replace(this._renderContent(e.item))},_afterReset:function(){if(!this.rendered)return;var t=this.get("container"),n=e.Rednose.Dropdown.ClassNames;t.one("."+n.menu).remove(),this.render()},_defClickFn:function(e){e.item.dropdown.toggle()},_defItemClickFn:function(e){this.fire(r,{originEvent:e.originEvent,dropdown:this,item:e.item,node:this.get("host")})}});e.Rednose.Dropdown=e.mix(i,e.Rednose.Dropdown),e.Rednose.Dropdown.ClassNames={disabled:"disabled",menu:"dropdown-menu",toggle:"dropdown-toggle",open:"open",divider:"divider",dropdown:"dropdown",icon:"icon",submenu:"dropdown-submenu",iconToggle:"icon-ok",item:"rednose-menu-item"},e.Rednose.Dropdown.Templates={menu:n.compile('<ul class="<%= data.classNames.menu %>"></ul>'),item:n.compile('<% if (data.item.type === "divider") { %><li class="<%= data.classNames.divider %>"></li><% } else { %><li class="<% if (data.item.isDisabled()) { %><%= data.classNames.disabled %> <% } %><% if (data.item.hasChildren()) { %><%= data.classNames.submenu %><% } %>"><% if (data.item.html) { %><%== data.item.html %><% } %></li><% } %>'),content:n.compile('<a href="<%= data.item.url %>" data-id="<%= data.item.id %>"><% if (data.item.icon) { %><i class="<%= data.classNames.icon %> <%= data.item.icon %>"></i> <% } else if (data.item.isActive()) { %><i class="<%= data.classNames.icon %> <%= data.classNames.iconToggle %>"></i> <% } %><span class="<%= data.classNames.item %>"><%= data.item.title %></span> </a>')}},"1.5.0-DEV",{requires:["event-outside","node","rednose-dropdown-base","template-micro","view"]});
