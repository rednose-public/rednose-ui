YUI.add("rednose-treeview-dd",function(e,t){var n=e.Base.create("dd",e.Base,[],{initializer:function(){this._ddMap=[],this.get("dragdrop")&&this._attachDdEvents()},destructor:function(){this._destroyDd(),this._detachDdEvents(),this._ddMap=null},sizeShims:function(){for(var e in this._ddMap)typeof this._ddMap[e].sizeShim=="function"&&this._ddMap[e].sizeShim()},_handleBind:function(t){var n=this,r=t.one("."+this.classNames.children).all("[data-rednose-type]:not(.rednose-treeview-drag)"),i=this.get("ddTest");r.each(function(t){var r=n.getNodeById(t.getData("node-id"));(i===null||typeof i=="function"&&i(r)===!0)&&n._createDd(t,r);var s=new e.DD.Drop({node:t,groups:n.get("groups"),bubbleTargets:n});t.addClass("rednose-treeview-drop"),t.addClass("rednose-dd-drop"),n._ddMap.push(s)}),this.header&&this._bindHeader()},_bindHeader:function(){var t=this.get("container"),n;n=new e.DD.Drop({node:t.one(".nav-header"),groups:this.get("groups"),bubbleTargets:this}),this._attachHeaderEvents(n),this._ddMap.push(n)},_createDd:function(t,n){var r=this.get("groups"),i;return n instanceof e.TB.Category&&(r=r.concat([e.stamp(this)])),i=new e.DD.Drag({node:t,data:n,groups:r,bubbleTargets:this}),i.plug(e.Plugin.DDProxy,{moveOnEnd:!1,borderStyle:"none"}),t.addClass("rednose-treeview-drag"),this._ddMap.push(i),i},_attachDdEvents:function(){this._ddEventHandles||(this._ddEventHandles=[]),this._ddEventHandles.push(e.Do.after(this._afterRender,this,"render",this),this.on({"drag:start":this._handleStart}),this.after("open",this._handleDdOpen))},_attachHeaderEvents:function(e){this._ddEventHandles.push(e.on({"drop:enter":this._handleHeaderEnter,"drop:exit":this._handleHeaderExit}))},_detachDdEvents:function(){(new e.EventHandle(this._ddEventHandles)).detach()},_destroyDd:function(){e.Array.each(this._ddMap,function(e){e.destroy()}),this._ddMap.length=0},_afterRender:function(){this._destroyDd(),this._handleBind(this.get("container"))},_handleHeaderEnter:function(e){var t=e.drop.get("node").ancestor(".rednose-treeview-outer-container");t.addClass("rednose-treeview-drop-over-global")},_handleHeaderExit:function(e){var t=e.drop.get("node").ancestor(".rednose-treeview-outer-container");t.hasClass("rednose-treeview-drop-over-global")&&t.removeClass("rednose-treeview-drop-over-global")},_handleDdOpen:function(e){if(!this.rendered)return;var t=e.node,n=this.getHTMLNode(t);this._handleBind(n)},_handleStart:function(t){var n=t.target,r,i,s;r=n.get("data"),n.get("dragNode").setContent(n.get("node").get("outerHTML")),s=n.get("node"),n._prep(),n.detachAll("drag:start"),i=e.Node.create("<div></div>"),n.set("node",i),n.set("target",!0),n._prep(),this._createDd(s,r)}},{ATTRS:{dragdrop:{value:!1},ddTest:{value:null},groups:{value:["rednose-treeview"]}}});e.namespace("Rednose.TreeView").DD=n},"1.5.0-DEV",{requires:["dd"]});
